# v1.2.0

## 发布日期
2026 年 2 月 3 日


---

## SDK

### 新功能

#### 运行时环境（Runtime Environment）
**[运行时环境参考文档](../References/Python%20SDK%20References/runtime-env.md)**

- **新增**：通过 `extra_symlink_dir` 和 `extra_symlink_executables` 支持可执行文件符号链接，可将运行时可执行文件暴露到系统路径

#### Model Service（实验性）
**[Model Service 参考文档](../References/Python%20SDK%20References/model-service.md)**

处理 Agent 与 LLM 推理服务之间的模型调用通信：
- Local 模式：Agent 与 Roll 运行时之间的文件通信，基于文件的通信协议，实现请求-响应机制
- Proxy 模式：支持请求转发到外部 LLM 服务，具备路由和重试功能

- SDK 支持 `anti_call_llm`，用于代理 Agent 请求
- **新增**：完整的 CLI start 命令参数（`--config-file`、`--host`、`--port`、`--proxy-base-url`、`--retryable-status-codes`、`--request-timeout`）
- **新增**：轨迹（traj）日志记录 - 将 LLM 请求/响应记录到 JSONL 文件（`ROCK_MODEL_SERVICE_DATA_DIR`、`ROCK_MODEL_SERVICE_TRAJ_APPEND_MODE`）
- **新增**：服务端 `ModelServiceConfig` 配置（`host`、`port`、`proxy_base_url`、`proxy_rules`、`retryable_status_codes`、`request_timeout`）

#### Agent 示例
**[示例目录](https://github.com/Modelized/ROCK/tree/master/examples/agents)**

演示 ROCK Agent 与各种 AI 框架集成的实践示例：

- **claude_code/**: Claude Code Agent 集成示例（使用 Node.js 运行时）
  - 命令：`claude -p ${prompt}`
  - 依赖：`npm install -g @anthropic-ai/claude-code`
  - 通过 `rock_agent_config.yaml` 配置

- **iflow_cli/**: iFlow CLI Agent 集成示例（使用 Node.js 运行时）
  - 命令：`iflow -p ${prompt} --yolo`
  - 依赖：`npm i -g @iflow-ai/iflow-cli@latest`

- **swe_agent/**: SWE Agent 集成示例
  - 演示标准 ROCK Agent 设置模式

- **iflow_cli/integration_with_model_service/**: Model Service 集成示例
  - **local/**: Local 模式示例，包含自定义 LLM 后端
    - 展示 `anti_call_llm` 用法和服务循环模式
  - **proxy/**: Proxy 模式示例，配合 iFlow CLI 使用
    - 演示 `rock model-service start --type proxy --proxy-base-url` 用法


## Admin

### 新功能

#### 任务调度器（Task Scheduler）
一个灵活的任务调度系统，用于管理 Ray Worker 节点上的周期性维护任务。

**内置任务：**
- **ImageCleanupTask**：使用 [docuum](https://github.com/stepchowfun/docuum) 进行 Docker 镜像清理，支持可配置的磁盘阈值

**配置示例：**
```yaml
scheduler:
  enabled: true
  worker_cache_ttl: 3600
  tasks:
    - task_class: "rock.admin.scheduler.tasks.image_cleanup_task.ImageCleanupTask"
      enabled: true
      interval_seconds: 3600
      params:
        threshold: "1T"
```

**可扩展性：**
通过继承 `BaseTask` 并实现 `run_action(runtime: RemoteSandboxRuntime)` 方法来创建自定义任务。

#### Entrypoints

- **新增**: 批量查询沙箱状态 API (`POST /sandboxes/batch`)
  - 在单个请求中高效检索多个沙箱的状态信息
  - 接受包含 `sandbox_ids` 列表的 `BatchSandboxStatusRequest` 请求
  - 返回包含所有请求沙箱状态详情的 `BatchSandboxStatusResponse` 响应
  - 支持可配置的最大数量限制（默认值来自 `batch_get_status_max_count` 配置）

- **新增**: 沙箱列表和过滤 API (`GET /sandboxes`)
  - 使用灵活的查询参数查询和过滤沙箱
  - 通过 `page` 和 `page_size` 参数支持分页
  - 返回包含条目列表、总数和 `has_more` 标识的 `SandboxListResponse` 响应
  - 支持按沙箱属性过滤（例如：部署类型、状态、自定义元数据等）
  - 最大页面大小可通过 `batch_get_status_max_count` 配置

#### Sandbox

- 修改 Sandbox 日志格式：时间戳使用 ISO 8601 格式，默认时区为 Asia/Shanghai（亚洲/上海）
- 丰富 SandboxInfo：添加 create_time、start_time、stop_time
- 添加计费日志：当 sandbox 关闭时记录计费日志

---

### 增强

#### 性能优化
- 实现 get_status 接口逻辑与 Ray 的解耦：将 API 响应耗时从 1s 以上显著降低至 100ms 级别；支持新旧逻辑的动态在线切换。
