"use strict";(globalThis.webpackChunkrock_docs=globalThis.webpackChunkrock_docs||[]).push([[9977],{1513(e,n,i){i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>d,default:()=>p,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"References/Python SDK References/rock-agent","title":"Rock Agent (Experimental)","description":"RockAgent is the core Agent implementation in the ROCK framework, inheriting directly from the Agent abstract base class. It provides complete Agent lifecycle management including environment initialization, ModelService integration, and command execution.","source":"@site/versioned_docs/version-1.1.x/References/Python SDK References/rock-agent.md","sourceDirName":"References/Python SDK References","slug":"/References/Python SDK References/rock-agent","permalink":"/ROCK/docs/References/Python SDK References/rock-agent","draft":false,"unlisted":false,"editUrl":"https://github.com/alibaba/ROCK/tree/master/docs/versioned_docs/version-1.1.x/References/Python SDK References/rock-agent.md","tags":[],"version":"1.1.x","lastUpdatedAt":1769567739000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Remote User","permalink":"/ROCK/docs/References/Python SDK References/remote_user"},"next":{"title":"RuntimeEnv","permalink":"/ROCK/docs/References/Python SDK References/runtime-env"}}');var r=i(4848),o=i(8453);const l={},d="Rock Agent (Experimental)",s={},c=[{value:"Core Concepts",id:"core-concepts",level:2},{value:"IFlowCli Config Example",id:"iflowcli-config-example",level:2},{value:"LangGraph Agent Example",id:"langgraph-agent-example",level:2},{value:"Detailed Config Example",id:"detailed-config-example",level:2},{value:"Usage Example",id:"usage-example",level:2},{value:"Using YAML Config File (Recommended)",id:"using-yaml-config-file-recommended",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"install(config)",id:"installconfig",level:3},{value:"run(prompt)",id:"runprompt",level:3},{value:"ModelService Integration",id:"modelservice-integration",level:2},{value:"RuntimeEnv Integration",id:"runtimeenv-integration",level:2},{value:"Notes",id:"notes",level:2},{value:"working_dir vs project_path",id:"working_dir-vs-project_path",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"rock-agent-experimental",children:"Rock Agent (Experimental)"})}),"\n",(0,r.jsxs)(n.p,{children:["RockAgent is the core Agent implementation in the ROCK framework, inheriting directly from the ",(0,r.jsx)(n.code,{children:"Agent"})," abstract base class. It provides complete Agent lifecycle management including environment initialization, ModelService integration, and command execution.\nUse ",(0,r.jsx)(n.code,{children:"sandbox.agent.install()"})," and ",(0,r.jsx)(n.code,{children:"sandbox.agent.run(prompt)"})," to install and run Agent in the ROCK Sandbox environment."]}),"\n",(0,r.jsx)(n.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,r.jsxs)(n.p,{children:["RockAgent provides simple APIs via ",(0,r.jsx)(n.code,{children:"sandbox.agent.install()"})," and ",(0,r.jsx)(n.code,{children:"sandbox.agent.run(prompt)"})," for installing and running Agent in the ROCK Sandbox environment."]}),"\n",(0,r.jsx)(n.h2,{id:"iflowcli-config-example",children:"IFlowCli Config Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'run_cmd: "iflow -p ${prompt} --yolo"           # ${prompt} is required\n\nruntime_env_config:\n  type: node                                    # IFlowCli uses Node runtime\n  npm_registry: "https://registry.npmmirror.com"\n  custom_install_cmd: "npm i -g @iflow-ai/iflow-cli@latest"\n\nenv:                                            # Environment variables\n  IFLOW_API_KEY: "xxxxxxx"\n  IFLOW_BASE_URL: "xxxxxxx"\n  IFLOW_MODEL_NAME: "Qwen3-Coder-Plus"\n\n'})}),"\n",(0,r.jsx)(n.h2,{id:"langgraph-agent-example",children:"LangGraph Agent Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'working_dir: "."                                # Upload current directory containing langgraph_agent.py to sandbox\n\nrun_cmd: "python langgraph_agent.py ${prompt}"  # Run local script\n\nruntime_env_config:\n  type: python\n  pip:                                           # Install Python dependencies\n    - langchain==1.2.3\n    - langchain-openai==1.1.7\n    - langgraph==1.0.6\n\nenv:\n  OPENAI_API_KEY: xxxxxxx\n\n'})}),"\n",(0,r.jsx)(n.h2,{id:"detailed-config-example",children:"Detailed Config Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# ========== Basic Config ==========\nagent_type: "default"                           # Agent type identifier (default: "default")\nagent_name: "demo-agent"                        # Agent instance name (default: random uuid)\nversion: "1.0.0"                                # Version identifier (default: "default")\ninstance_id: "instance-001"                     # Instance ID (default: "instance-id-<random_uuid>")\nagent_installed_dir: "/tmp/installed_agent"     # Agent installation directory (default: "/tmp/installed_agent")\nagent_session: "my-session"                     # Bash session identifier (default: "agent-session-<random_uuid>")\nenv:                                             # Environment variables (default: {})\n  OPENAI_API_KEY: "xxxxxxx"\n\n# ========== Working Directory Config ==========\nworking_dir: "./my_project"                     # Local directory, upload to sandbox (default: None, no upload)\nproject_path: "/testbed"                        # Working directory in sandbox, used for cd (default: None)\nuse_deploy_working_dir_as_fallback: true        # Fall back to deploy.working_dir when project_path is empty (default: true)\n\n# ========== Runtime Config ==========\nrun_cmd: "python main.py --prompt {prompt}"     # Agent execution command, must contain {prompt} (default: None)\n# run_cmd: "python ${working_dir}/main.py --prompt {prompt}"  # ${working_dir} will be replaced with actual path\n\n# Timeout Config\nagent_install_timeout: 600                      # Install timeout in seconds (default: 600)\nagent_run_timeout: 1800                         # Run timeout in seconds (default: 1800)\nagent_run_check_interval: 30                    # Check interval in seconds (default: 30)\n\n\n# ========== Pre/Post Init Commands ==========\npre_init_cmds:                                   # Commands to execute before initialization (default: from env_vars)\n  - command: "apt update && apt install -y git"\n    timeout_seconds: 300                         # Command timeout in seconds (default: 300)\n  - command: "cp ${working_dir}/config.json /root/.config/config.json"\n    timeout_seconds: 60\n\npost_init_cmds:                                  # Commands to execute after initialization (default: [])\n  - command: "echo \'Installation complete\'"\n    timeout_seconds: 30\n\n# ========== Runtime Environment Config ==========\nruntime_env_config:  # See RuntimeEnv documentation for details\n  type: "python"                                # Runtime type: python / node (default: "python")\n\n# ========== ModelService Integration ==========\nmodel_service_config:                            # See ModelService documentation for details\n  enabled: true                                  # Enable ModelService (default: false)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,r.jsx)(n.h3,{id:"using-yaml-config-file-recommended",children:"Using YAML Config File (Recommended)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# prepare a rock_agent_config.yaml\nawait sandbox.agent.install()\nawait sandbox.agent.run(prompt="hello")\n'})}),"\n",(0,r.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,r.jsx)(n.h3,{id:"installconfig",children:"install(config)"}),"\n",(0,r.jsx)(n.p,{children:"Initialize Agent environment."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Flow:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"working_dir"})," is configured, deploy to sandbox"]}),"\n",(0,r.jsx)(n.li,{children:"Setup bash session and configure env variables"}),"\n",(0,r.jsxs)(n.li,{children:["Execute ",(0,r.jsx)(n.code,{children:"pre_init_cmds"})]}),"\n",(0,r.jsx)(n.li,{children:"Parallel initialize RuntimeEnv and ModelService (if enabled)"}),"\n",(0,r.jsxs)(n.li,{children:["Execute ",(0,r.jsx)(n.code,{children:"post_init_cmds"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config"}),": YAML config file path or ",(0,r.jsx)(n.code,{children:"RockAgentConfig"})," object"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"runprompt",children:"run(prompt)"}),"\n",(0,r.jsx)(n.p,{children:"Execute Agent task."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Flow:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Replace ",(0,r.jsx)(n.code,{children:"${prompt}"})," placeholder in command"]}),"\n",(0,r.jsxs)(n.li,{children:["Replace ",(0,r.jsx)(n.code,{children:"${working_dir}"})," placeholder"]}),"\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"project_path"})," is configured, execute ",(0,r.jsx)(n.code,{children:"cd project_path"})]}),"\n",(0,r.jsx)(n.li,{children:"Start agent process"}),"\n",(0,r.jsxs)(n.li,{children:["If ModelService is enabled, start ",(0,r.jsx)(n.code,{children:"watch_agent"})]}),"\n",(0,r.jsx)(n.li,{children:"Wait for task completion and return result"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"modelservice-integration",children:"ModelService Integration"}),"\n",(0,r.jsx)(n.p,{children:"RockAgent automatically manages ModelService lifecycle:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"model_service_config:\n  enabled: true                                  # Enable ModelService\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Auto-executed:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Install phase: Install ModelService (install only, not start)"}),"\n",(0,r.jsxs)(n.li,{children:["Run phase: Start ModelService + ",(0,r.jsx)(n.code,{children:"watch_agent"})," to monitor process"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"runtimeenv-integration",children:"RuntimeEnv Integration"}),"\n",(0,r.jsxs)(n.p,{children:["RockAgent automatically manages runtime environment, initializing RuntimeEnv in parallel during ",(0,r.jsx)(n.code,{children:"install()"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'runtime_env_config:  # See RuntimeEnv documentation for details\n  type: "python"        # Runtime type: python / node\n  version: "3.11"       # Version\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Auto-executed:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Install corresponding runtime based on ",(0,r.jsx)(n.code,{children:"type"})," (Python or Node.js)"]}),"\n",(0,r.jsxs)(n.li,{children:["Install ",(0,r.jsx)(n.code,{children:"pip"})," dependencies (if configured)"]}),"\n",(0,r.jsxs)(n.li,{children:["Execute ",(0,r.jsx)(n.code,{children:"custom_install_cmd"})," custom install command (if configured)"]}),"\n",(0,r.jsxs)(n.li,{children:["Support ",(0,r.jsx)(n.code,{children:"npm_registry"})," for Node.js npm mirror"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example: Configure Python Runtime"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'runtime_env_config:\n  type: "python"\n  version: "3.11"\n  pip:\n    - package1==1.0.0\n    - package2==2.0.0\n  custom_install_cmd: "git clone https://github.com/SWE-agent/SWE-agent.git && cd SWE-agent && pip install -e ."\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example: Configure Node Runtime"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'runtime_env_config:\n  type: "node"\n  version: "20"\n  npm_registry: "https://registry.npmmirror.com"\n  custom_install_cmd: "npm i -g some-package"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsx)(n.h3,{id:"working_dir-vs-project_path",children:"working_dir vs project_path"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Config"}),(0,r.jsx)(n.th,{children:"Purpose"}),(0,r.jsx)(n.th,{children:"How it Works"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"working_dir"})}),(0,r.jsx)(n.td,{children:"Local directory, upload to sandbox"}),(0,r.jsxs)(n.td,{children:["Call ",(0,r.jsx)(n.code,{children:"deploy.deploy_working_dir()"})," to upload, after upload ",(0,r.jsx)(n.code,{children:"deploy.working_dir"})," becomes sandbox path"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"${working_dir}"})}),(0,r.jsx)(n.td,{children:"Placeholder in commands"}),(0,r.jsxs)(n.td,{children:["Replaced by ",(0,r.jsx)(n.code,{children:"deploy.format()"})," with ",(0,r.jsx)(n.code,{children:"deploy.working_dir"})," value, replaced in init_cmds and run_cmd"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"project_path"})}),(0,r.jsx)(n.td,{children:"Working directory in sandbox"}),(0,r.jsxs)(n.td,{children:["Used for ",(0,r.jsx)(n.code,{children:"cd project_path"})," before running, if not set, work in ",(0,r.jsx)(n.code,{children:"deploy.working_dir"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"use_deploy_working_dir_as_fallback"})}),(0,r.jsx)(n.td,{children:"When running command, whether to fall back to deploy.working_dir if project_path is not set"}),(0,r.jsx)(n.td,{})]})]})]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>d});var t=i(6540);const r={},o=t.createContext(r);function l(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);