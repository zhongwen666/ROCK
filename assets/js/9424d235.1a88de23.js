"use strict";(globalThis.webpackChunkrock_docs=globalThis.webpackChunkrock_docs||[]).push([[2248],{40331(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"References/Python SDK References/sandbox","title":"Handling Large Files and Long Command Outputs","description":"arun","source":"@site/versioned_docs/version-1.1.x/References/Python SDK References/sandbox.md","sourceDirName":"References/Python SDK References","slug":"/References/Python SDK References/sandbox","permalink":"/ROCK/docs/1.1.x/References/Python SDK References/sandbox","draft":false,"unlisted":false,"editUrl":"https://github.com/alibaba/ROCK/tree/master/docs/versioned_docs/version-1.1.x/References/Python SDK References/sandbox.md","tags":[],"version":"1.1.x","lastUpdatedAt":1770690437000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"RuntimeEnv","permalink":"/ROCK/docs/1.1.x/References/Python SDK References/runtime-env"},"next":{"title":"Release Notes","permalink":"/ROCK/docs/1.1.x/Release Notes/"}}');var t=s(74848),r=s(28453);const l={},d="Handling Large Files and Long Command Outputs",o={},a=[{value:"<code>arun</code>",id:"arun",level:2},{value:"<code>read_file_by_line_range</code>",id:"read_file_by_line_range",level:2},{value:"Key Features",id:"key-features",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Return Value",id:"return-value",level:3},{value:"Exception Handling",id:"exception-handling",level:3},{value:"Usage Examples",id:"usage-examples",level:3},{value:"Notes",id:"notes",level:3}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"handling-large-files-and-long-command-outputs",children:"Handling Large Files and Long Command Outputs"})}),"\n",(0,t.jsx)(n.h2,{id:"arun",children:(0,t.jsx)(n.code,{children:"arun"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"arun()"})," provides two knobs to control how ",(0,t.jsx)(n.code,{children:"nohup"})," output is handled:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"response_limited_bytes_in_nohup"})})," ",(0,t.jsx)(n.em,{children:"(integer type)"}),"\nCaps the number of characters returned from the nohup output file. Useful when you still need to stream some logs back but want an upper bound (default ",(0,t.jsx)(n.code,{children:"None"})," = no cap)."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"ignore_output"})})," ",(0,t.jsxs)(n.em,{children:["(bool, default ",(0,t.jsx)(n.code,{children:"False"}),")"]}),"\nWhen set to ",(0,t.jsx)(n.code,{children:"True"}),", ",(0,t.jsx)(n.code,{children:"arun()"})," skips reading the nohup output file entirely. The command still runs to completion and writes logs to ",(0,t.jsx)(n.code,{children:"/tmp/tmp_<timestamp>.out"}),", but the SDK immediately returns a lightweight hint telling agents where to fetch the logs later (via ",(0,t.jsx)(n.code,{children:"read_file"}),', download APIs, or custom commands). This fully decouples "execute command" from "inspect logs". The response also includes the ',(0,t.jsx)(n.strong,{children:"file size"})," to help users decide whether to download directly or read in chunks."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from rock.sdk.sandbox.client import Sandbox\nfrom rock.sdk.sandbox.config import SandboxConfig\nfrom rock.sdk.sandbox.request import CreateBashSessionRequest\n\nconfig = SandboxConfig(\n    image=f"{image}",\n    xrl_authorization=f"{xrl_authorization}",\n    user_id=f"{user_id}",\n    cluster=f"{cluster}",\n)\nsandbox = Sandbox(config)\n\nsession = sandbox.create_session(CreateBashSessionRequest(session="bash-1"))\n\n# Example 1: limit the returned logs to 1024 characters\nresp_limited = asyncio.run(\n    sandbox.arun(\n        cmd="cat /tmp/test.txt",\n        mode="nohup",\n        session="bash-1",\n        response_limited_bytes_in_nohup=1024,\n    )\n)\n\n# Example 2: skip collecting logs; agent will download/read them later\nresp_detached = asyncio.run(\n    sandbox.arun(\n        cmd="bash run_long_job.sh",\n        mode="nohup",\n        session="bash-1",\n        ignore_output=True,\n    )\n)\nprint(resp_detached.output)\n# Command executed in nohup mode without streaming the log content.\n# Status: completed\n# Output file: /tmp/tmp_xxx.out\n# File size: 15.23 MB\n# Use Sandbox.read_file(...), download APIs, or run \'cat /tmp/tmp_xxx.out\' ...\n'})}),"\n",(0,t.jsx)(n.h2,{id:"read_file_by_line_range",children:(0,t.jsx)(n.code,{children:"read_file_by_line_range"})}),"\n",(0,t.jsx)(n.p,{children:"Asynchronously reads file content by line range, with built-in support for automatic chunking and session management. Supports large file reading."}),"\n",(0,t.jsx)(n.h3,{id:"key-features",children:"Key Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Chunked reading for large files"}),": Automatically splits large files into chunks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Automatic line count"}),": Estimates total lines when end_line is not specified"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Built-in retry mechanism"}),": Up to 3 retries for critical operations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Input validation"}),": Validates input parameters automatically"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Session management"}),": Supports custom session or auto-created temporary session"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"file_path"})}),(0,t.jsx)(n.td,{children:"str"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"File path to read (absolute or relative path in sandbox)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"start_line"})}),(0,t.jsx)(n.td,{children:"int | None"}),(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"Starting line number (1-based)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"end_line"})}),(0,t.jsx)(n.td,{children:"int | None"}),(0,t.jsx)(n.td,{children:"None"}),(0,t.jsx)(n.td,{children:"Ending line number (inclusive), defaults to file end"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"lines_per_request"})}),(0,t.jsx)(n.td,{children:"int"}),(0,t.jsx)(n.td,{children:"1000"}),(0,t.jsx)(n.td,{children:"Lines per request, range 1-10000"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"return-value",children:"Return Value"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ReadFileResponse"}),": Response object containing file content","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"content"})," (str): The file content read"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"exception-handling",children:"Exception Handling"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Exception"}),": Raised when ",(0,t.jsx)(n.code,{children:"start_line < 1"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Exception"}),": Raised when ",(0,t.jsx)(n.code,{children:"end_line < start_line"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Exception"}),": Raised when ",(0,t.jsx)(n.code,{children:"lines_per_request"})," is not in range 1-10000"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Exception"}),": Raised when file reading fails"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Read the entire file\nresponse = await sandbox.read_file_by_line_range("/path/to/file.txt")\n\n# Read a specific line range (lines 100 to 500)\nresponse = await sandbox.read_file_by_line_range(\n    "/path/to/file.txt",\n    start_line=100,\n    end_line=500\n)\n\n# Read from line 1990 to the end of file\nresponse = await sandbox.read_file_by_line_range(\n    "/path/to/file.txt",\n    start_line=1990\n)\n\n# Use custom chunk size\nresponse = await sandbox.read_file_by_line_range(\n    "/path/to/file.txt",\n    lines_per_request=5000\n)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"notes",children:"Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Line numbers are 1-based, not 0-based"}),"\n",(0,t.jsxs)(n.li,{children:["For large files, consider increasing ",(0,t.jsx)(n.code,{children:"lines_per_request"})," for better efficiency"]}),"\n",(0,t.jsx)(n.li,{children:"File path must be a valid path within the sandbox"}),"\n",(0,t.jsxs)(n.li,{children:["Uses ",(0,t.jsx)(n.code,{children:"sed"})," command for file reading; ensure the sandbox image supports this command"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453(e,n,s){s.d(n,{R:()=>l,x:()=>d});var i=s(96540);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);