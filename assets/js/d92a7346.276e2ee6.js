"use strict";(globalThis.webpackChunkrock_docs=globalThis.webpackChunkrock_docs||[]).push([[8913],{54247(e,r,n){n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"References/Python SDK References/codes","title":"Error Codes","description":"Error code definitions and categories for error handling and retry strategies.","source":"@site/versioned_docs/version-1.2.x/References/Python SDK References/codes.md","sourceDirName":"References/Python SDK References","slug":"/References/Python SDK References/codes","permalink":"/ROCK/docs/References/Python SDK References/codes","draft":false,"unlisted":false,"editUrl":"https://github.com/alibaba/ROCK/tree/master/docs/versioned_docs/version-1.2.x/References/Python SDK References/codes.md","tags":[],"version":"1.2.x","lastUpdatedAt":1772263846000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Python SDK Reference","permalink":"/ROCK/docs/References/Python SDK References/python_sdk"},"next":{"title":"Deploy","permalink":"/ROCK/docs/References/Python SDK References/deploy"}}');var o=n(74848),t=n(28453);const i={},c="Error Codes",a={},d=[{value:"Usage Example",id:"usage-example",level:2},{value:"Codes Categories",id:"codes-categories",level:2},{value:"Retry Strategy Recommendations",id:"retry-strategy-recommendations",level:2},{value:"Retry Example",id:"retry-example",level:2}];function l(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"error-codes",children:"Error Codes"})}),"\n",(0,o.jsx)(r.p,{children:"Error code definitions and categories for error handling and retry strategies."}),"\n",(0,o.jsx)(r.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-python",children:'import rock\n\ndef test_codes_values():\n    """Test basic status code values"""\n    assert rock.codes.OK == 2000\n    assert rock.codes.BAD_REQUEST == 4000\n    assert rock.codes.INTERNAL_SERVER_ERROR == 5000\n    assert rock.codes.COMMAND_ERROR == 6000\n'})}),"\n",(0,o.jsx)(r.h2,{id:"codes-categories",children:"Codes Categories"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-python",children:'OK = 2000, "OK"\n"""\nSuccess codes (2xxx)\n"""\n\nBAD_REQUEST = 4000, "Bad Request"\n"""\nClient error codes (4xxx):\n\nThese errors indicate issues with the client request,\nSDK will raise Exceptions for these errors.\n"""\n\nINTERNAL_SERVER_ERROR = 5000, "Internal Server Error"\n"""\nServer error codes (5xxx):\n\nThese errors indicate issues on the server side,\nSDK will raise Exceptions for these errors.\n"""\n\nCOMMAND_ERROR = 6000, "Command Error"\n"""\nCommand/execution error codes (6xxx):\n\nThese errors are related to command execution and should be handled by the model,\nSDK will NOT raise Exceptions for these errors.\n"""\n'})}),"\n",(0,o.jsx)(r.h2,{id:"retry-strategy-recommendations",children:"Retry Strategy Recommendations"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Retry trigger"}),": Only retry when ",(0,o.jsx)(r.code,{children:"INTERNAL_SERVER_ERROR"})," occurs"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Other error handling"}),":","\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.code,{children:"BAD_REQUEST"}),": Check if there are issues with the arun call logic"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.code,{children:"COMMAND_ERROR"}),": stdout goes to ",(0,o.jsx)(r.code,{children:"observation.output"}),", stderr goes to ",(0,o.jsx)(r.code,{children:"observation.failure_reason"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.code,{children:"COMMAND_ERROR"})," note: When bash execution fails, both stdout and stderr may be non-empty. It is recommended to prompt the model with both output and failure_reason from the observation."]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"retry-example",children:"Retry Example"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-python",children:'# Background execution with nohup\nwhile retry_times < retry_limit:\n    try:\n        observation: Observation = await sandbox.arun(\n            "python long_running_script.py",\n            mode="nohup"\n        )\n        if observation.exit_code != 0:\n            logging.warning(\n                f"Command failed with exit code {observation.exit_code}, "\n                f"output: {observation.output}, failure_reason: {observation.failure_reason}"\n            )\n        return observation\n    except RockException as e:\n        if rock.codes.is_server_error(e.code):\n            if retry_times >= retry_limit:\n                logging.error(f"All {retry_limit} attempts failed")\n                raise e\n            else:\n                retry_times += 1\n                logging.error(\n                    f"Server error occurred, code: {e.code}, message: {e.code.get_reason_phrase()}, "\n                    f"exception: {str(e)}, will retry, times: {retry_times}."\n                )\n                await asyncio.sleep(2)\n                continue\n        else:\n            logging.error(\n                f"Non-retriable error occurred, code: {e.code}, message: {e.code.get_reason_phrase()}, exception: {str(e)}."\n            )\n            raise e\n'})})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453(e,r,n){n.d(r,{R:()=>i,x:()=>c});var s=n(96540);const o={},t=s.createContext(o);function i(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);